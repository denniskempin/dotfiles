#!/bin/bash
set -e
cd "$(dirname "$0")"

PACKAGES=(
  fish
  neovim
  thefuck   # Corrects common command mistakes (e.g. prepending sudo)
  tldr      # tldr versins of man pages
  bat       # better cat
  zoxide    # better cd (with fuzzy matching and autojump)
  exa       # better ls
  grc       # generic colorizer for standard commands
  fd        # better find
  less      # Newer version has --mouse support
  git-delta # Better git diff
  sd        # Better sed
  ripgrep   # Better grep
  procs     # Better ps
  bottom    # Better top
  fzf       # fuzzy finder
)

setup_fish() {
  # Link config files
  mkdir -p ~/.config/fish/
  ln -sf "$(pwd)/fish/config.fish" ~/.config/fish/config.fish
  ln -sf "$(pwd)/fish/fish_plugins" ~/.config/fish/fish_plugins
  ln -sf "$(pwd)/fish/starship.toml" ~/.config/starship.toml

  # Install starship prompt
  sh -c "$(curl -fsSL https://starship.rs/install.sh)" -- -y

  # Install fisher plugins
  fish -c "curl -sL https://git.io/fisher | source && fisher update"
}

setup_nvim() {
  rm -rf ~/.config/nvim
  ln -sf "$(pwd)/nvim" ~/.config/nvim

  curl -fLo ~/.local/share/nvim/site/autoload/plug.vim \
    --create-dirs \
    https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
}

install_packages() {
  pacman -Sy --noconfirm "${PACKAGES[@]}"
}

main() {
  # Get sudo upfront so we don't need to ask later.
  sudo true

  if command -v pacman >/dev/null; then
    install_packages
    setup_fish
    setup_nvim
  else
    echo "This script is intendend only for archlinux dev containers."
  fi
}
main
